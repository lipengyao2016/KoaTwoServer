/**
 * Created by Administrator on 2016/12/17.
 */

"use strict";
const utils= require('commonutils').utils;
const request = require('commonutils').request.request;
const _ = require('lodash');


class DistritubeTranction {
    constructor() {
        console.log(' DistritubeTranction -->constructor  ' );
        this.sucedHrefs = [];
    };

    addSucHref(hrefs) {
        this.sucedHrefs = _.concat(this.sucedHrefs,hrefs);
    };

    addSingleSuc(href) {
        this.sucedHrefs.push(href);
    };

    *rollBack()
    {
        let ret =true;
        console.log('DistritubeTranction-->rollBack sucedHrefs:',this.sucedHrefs);
        if(this.sucedHrefs.length > 0)
        {
            let rolReqs = this.sucedHrefs.map(curHref=>
            {
                return request.deleteRequest(curHref);
            })

            let results =yield rolReqs;



            for(let result of results)
            {
                if(result.res.statusCode != 204 )
                {
                    ret =false;
                    break;
                }
            }

            this.sucedHrefs.splice(0,this.sucedHrefs.length);
        }

        console.log('DistritubeTranction-->rollBack ret:',ret);

        return ret;
    }

}


module.exports = DistritubeTranction;